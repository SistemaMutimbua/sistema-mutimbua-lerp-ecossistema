<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{{ titulo_pagina or _("LERP Management System") }}</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
/* ===== Layout Geral ===== */
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f8f9fa; }

/* ===== Sidebar ===== */
.sidebar { position: fixed; top:0; left:0; width:220px; height:100%; background:#132a63; padding:20px; display:flex; flex-direction:column; overflow-y:auto; }
.sidebar h4 { color:#fff; text-align:center; margin-bottom:2rem; font-weight:bold; }
.sidebar a { color:#fff; text-decoration:none; padding:10px 15px; margin-bottom:5px; border-radius:5px; display:flex; align-items:center; gap:10px; transition:background 0.3s; }
.sidebar a.active, .sidebar a:hover { background-color:#0f214f; }
.sidebar a.text-danger:hover { background-color:#b22222; }

/* ===== ConteÃºdo principal ===== */
.content { margin-left:240px; padding:20px; background: #f0f2f5; min-height: 100vh; }

.top-bar h5 { color:#132a63; font-weight:bold; }
.btn-logout { background:#b22222; color:white; padding:6px 12px; border-radius:6px; text-decoration:none; font-weight:bold; }
.btn-logout:hover { background:#8b0000; color:white; }

.notification-icon { color:#d4af37; font-size:1.3rem; position:relative; }
.notification-badge { position:absolute; top:-5px; right:-5px; font-size:0.7rem; background:red; color:white; padding:2px 5px; border-radius:50%; }

.language-switcher { text-align:center; margin-bottom:20px; }
.language-switcher a { text-decoration:none; margin:0 5px; font-weight:bold; color:#132a63; }
.language-switcher a:hover { text-decoration:underline; }

.flash-message { font-weight:bold; }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <h4>{{ _("LERP Management System") }}</h4>

    <a href="{{ url_for('admin.dashboard') }}" class="{% if request.endpoint.startswith('admin.') %}active{% endif %}">
        <i class="bi bi-speedometer2 text-info"></i> {{ _("Painel") }}
    </a>
    <a href="{{ url_for('produtos.lista_produtos') }}" class="{% if request.endpoint.startswith('produtos.') %}active{% endif %}">
        <i class="bi bi-box-seam text-warning"></i> {{ _("Produtos") }}
    </a>
    <a href="{{ url_for('compras.lista_compras') }}" class="{% if request.endpoint.startswith('compras.') %}active{% endif %}">
        <i class="bi bi-cart-plus-fill text-success"></i> {{ _("Compras") }}
    </a>
    <a href="{{ url_for('vendas.lista_vendas') }}" class="{% if request.endpoint.startswith('vendas.') %}active{% endif %}">
        <i class="bi bi-cash-coin text-primary"></i> {{ _("Vendas") }}
    </a>
    <a href="{{ url_for('pagamentos.lista_pagamentos') }}" class="{% if request.endpoint.startswith('pagamentos.') %}active{% endif %}">
        <i class="bi bi-wallet2 text-info"></i> {{ _("Pagamentos") }}
    </a>
    <a href="{{ url_for('caixa.lista_caixa') }}" class="{% if request.endpoint.startswith('caixa.') %}active{% endif %}">
        <i class="bi bi-currency-exchange text-success"></i> {{ _("Caixa") }}
    </a>
    <a href="{{ url_for('relatorios.dashboard') }}" class="{% if request.endpoint.startswith('relatorios.') %}active{% endif %}">
        <i class="bi bi-bar-chart-fill text-secondary"></i> {{ _("RelatÃ³rios") }}
    </a>
    <a href="{{ url_for('notificacoes.lista_notificacoes') }}" class="{% if request.endpoint.startswith('notificacoes.') %}active{% endif %}">
        <i class="bi bi-bell-fill notification-icon"></i>
        {% if current_user.is_authenticated %}
            {% set total_notifs = current_user.notificacoes|length %}
            {% if total_notifs > 0 %}
                <span class="notification-badge">{{ total_notifs }}</span>
            {% endif %}
        {% endif %}
        {{ _("NotificaÃ§Ãµes") }}
    </a>
    <a href="{{ url_for('admin.logout_admin') }}" class="mt-auto text-danger"><i class="bi bi-box-arrow-right"></i> {{ _("Sair") }}</a>
</div>

<!-- ConteÃºdo principal -->
<div class="content">
    <div class="top-bar d-flex justify-content-between align-items-center mb-3">
        <h5>{{ titulo_pagina or _("LERP Management System") }}</h5>
        <div class="d-flex align-items-center gap-3">
            <a href="{{ url_for('notificacoes.lista_notificacoes') }}" class="position-relative">
                <i class="bi bi-bell-fill notification-icon"></i>
                {% if current_user.is_authenticated %}
                    {% set total_notifs = current_user.notificacoes|length %}
                    {% if total_notifs > 0 %}
                        <span class="notification-badge">{{ total_notifs }}</span>
                    {% endif %}
                {% endif %}
            </a>
            <a href="{{ url_for('admin.logout_admin') }}" class="btn-logout">
                <i class="bi bi-box-arrow-right"></i> {{ _("Sair") }}
            </a>
        </div>
    </div>

    <!-- Language Switcher -->
    <div class="language-switcher">
        <a href="{{ url_for_current(lang='pt') }}">ðŸ‡µðŸ‡¹ {{ _("PortuguÃªs") }}</a> |
        <a href="{{ url_for_current(lang='en') }}">ðŸ‡¬ðŸ‡§ {{ _("InglÃªs") }}</a> |
        <a href="{{ url_for_current(lang='fr') }}">ðŸ‡«ðŸ‡· {{ _("FrancÃªs") }}</a>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="container mt-2">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} flash-message text-center shadow-sm" role="alert">
                {{ _(message) }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
setTimeout(() => { 
    document.querySelectorAll('.flash-message').forEach(msg => msg.remove()); 
}, 2500);
</script>

</body>
</html>
